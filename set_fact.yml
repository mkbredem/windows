---
- name: Get hostname
  hosts: all
  gather_facts: yes

  tasks:
  - name: Get hostname using win_shell
    win_shell: hostname
    register: ComputerName

  - name: Store hostname in a variable
    set_fact:
      my_hostname: "{{ ComputerName.stdout_lines[0] }}"

#  - name: store my_hostname as dictionary in set_stats
#    set_stats:
#      data:
#        some_stat: "{{ some_stat|default({})|combine({item: {'my_hostname': hostvars[item]['my_hostname']}}) }}"
#    loop: "{{ groups['all'] }}"

  - name: store my_hostname as dictionary in set_stats
    set_stats:
      data:
        some_stat: >-
          {{
            some_stat
            | default({})
            | combine({item: {'my_hostname': hostvars[item]['my_hostname']}})
          }}
    loop: "{{ groups['all'] }}"


